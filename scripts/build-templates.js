#!/usr/bin/env node
// Build script to convert HTML templates to TypeScript module
const fs = require('fs');
const path = require('path');

const publicDir = path.join(__dirname, '../public');
const outputFile = path.join(__dirname, '../src/ui-templates-generated.ts');

// Read HTML templates
const templates = {
  oauthSetup: fs.readFileSync(path.join(publicDir, 'html/oauth-setup.html'), 'utf8'),
  success: fs.readFileSync(path.join(publicDir, 'html/success.html'), 'utf8'),
  error: fs.readFileSync(path.join(publicDir, 'html/error.html'), 'utf8'),
};

// Escape template literals
const escapeTemplate = (str) => {
  return str
    .replace(/\\/g, '\\\\')  // Escape backslashes
    .replace(/`/g, '\\`')    // Escape backticks
    .replace(/\${/g, '\\${'); // Escape template expressions
};

// Generate TypeScript module
const output = `// Auto-generated file - DO NOT EDIT
// Generated by scripts/build-templates.js

export const templates = {
  oauthSetup: \`${escapeTemplate(templates.oauthSetup)}\`,
  success: \`${escapeTemplate(templates.success)}\`,
  error: \`${escapeTemplate(templates.error)}\`,
};
`;

// Write the output file
fs.writeFileSync(outputFile, output);
console.log('âœ… Templates built successfully to src/ui-templates-generated.ts');